---
layout: post
comments: true
title: Exploring Multi-Agent Reinforcement Learning in Metadrive Simulation
author: Wenhao Shen (Team 16)
date: 2022-10-19
---


>Autonomous vehicle driving has always been one of the most significant field that AI could be applied on. This problem could be solved with making the agent learn gradually improve its policy with its exprience in the environment -- Reinforcement Learning. One senario of this problem is that all vehicles are self-driven particles making this problem a multi-agent system. This project seeks to research MARL under this situation, explore the optimization of coordinated policy in this multi-agent environment.

<!--more-->
{: class="table-of-content"}
* TOC
{:toc}

## Problem Statement
In this quarter, the team will try to explore these feilds or solve these problems:
-Setting up the Metadrive vehicle simulator, including muti-agent setting up
-Successfully train RL models in the environment
-Explore policy optimization
    -Coordinate agents' behavior while maximizing individual reward
    -Experiment on different situations and improve safety and efficiency
The main steps and procedures will be coming from Metadrive github (https://github.com/metadriverse/metadrive) and Code for Coordinated Policy Optimization (https://github.com/decisionforce/CoPO). As a signle person project, the current goal of the project is to try to reproduce the results and explore the possible optimization to the model, rather than building a new model from scratch.

## What is MARL?
Multi-Agent Reinforcement Learning is a subfield of reinforcement learning. Unlike original reinforcement learning which usually concerns about a signle agent, MARL forcus on the interaction of multible agent under the same environment. Each agent is motivated by its own interest and action to advance it. In some environment, the relationship could also be competitive. Genrally MARL could be broken into 3 settings.
-Pure competitive: agents' rewards are opposite to each other
-Pure cooperation: agents' reward are shared or the same
-Mixed-sum: a mix of the above, agents seperated into groups
Here, in our Metadrive setting environment, it is a pure cooperation setting. In driving simulation, all agent cars share the reward and the goal is to maximize each agent's reward without lowering others', that means to maximize the global reward. To maximize it, we will need Cooperative Multi-Agent Reinforcement Learning (CoMARL). 


## Environment setting up
MetaDrive is a driving simulator that is compositional, lightweight and realistic. The team consider this driving senario generator a great test generator for the reinforcemnt learning methods.
Following the instructions on MetaDrive website, the team successfully installled MetaDrive and runs a simple driving simulation.
![Testdrive]({{ '/assets/images/team16/Metatest.png' | relative_url }})
{: style="width: 400px; max-width: 100%;"}
*Fig 1. A test environment of simple driving simulation [1].

## MARL Environment Example
Metadrive provide us with a few MARL example runs. Here the team practiced on themselves. The example includes different shapes of roads.
![Pgnaexample]({{ '/assets/images/team16/Examplepgna.png' | relative_url }})
{: style="width: 400px; max-width: 100%;"}
*Fig 2. A MARL enviroment example on a winding road [2].

![Roundaboatexample]({{ '/assets/images/team16/Exampleroundaboat.png' | relative_url }})
{: style="width: 400px; max-width: 100%;"}
*Fig 3. A MARL enviroment example on a roundaboat [3].
In the examples, the models are already trained and runned. We need further investigation on CoPO.

## What is CoPO and why choose that?
This part will be referenced from CoPO github. Currently working on it.


## Current progress
Setting up MetaDrive Environment (check)
Running Example environment (check)
Investigate CoPO code (working)
Reproduce and evaluate results (working)



## Referenced papers
Peng, Zhenghao, et al. “Learning to Simulate Self-Driven Particles System with Coordinated Policy Optimization.” ArXiv.org, 10 Jan. 2022, https://arxiv.org/abs/2110.13827. 

Zhang, Kaiqing, et al. “Multi-Agent Reinforcement Learning: A Selective Overview of Theories and Algorithms.” ArXiv.org, 24 Nov. 2019, https://arxiv.org/abs/1911.10635v1. 

Hernandez-Leal, Pablo, et al. “A Survey and Critique of Multiagent Deep Reinforcement Learning.” ArXiv.org, 30 Aug. 2019, https://arxiv.org/abs/1810.05587. 